<!DOCTYPE html>
<meta charset="UTF-8">
<body>
    <div id="chart"></div>
    <div class="chartTooltip hidden">
        <p>
            <strong class="name"></strong>
        </p>
    </div>
    <!-- load the d3.js library -->
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="./js/lib/css/d3-context-menu.css" type="text/css" />
    <script type="text/javascript" src="./js/lib/d3-context-menu.js"></script>
    <link rel="stylesheet" href="./css/chart.css" type="text/css" />
    <script src="./js/chart.js" type="module"></script>
    <script>
        const my = {
            chart: null,
            data: null
        }
    </script>
    <script type="module">
        import Chart from './js/chart.js';

        d3.json('./res.json')
            .then(data => {
                my.data = data;

                /*初始化宽高*/
                const ct = d3.select("#chart");
                //const [width, height] = ['width', 'height'].map(e => parseInt(ct.style(e)))
                //const [width, height] = [1628, 900];
                let { innerWidth: width, innerHeight: height } = window;
                
                // 这里我们将svg元素，和子group元素拆分
                const svg = ct
                    .append("svg")
                    // 设置svg宽高
                    // .attr("preserveAspectRatio", "xMidYMid meet")
                    // .attr("viewBox", "0 0 400 400");
                svg
                    .attr("width", width)
                    .attr("height", height)
                    .attr("viewBox", [- width / 2, - height / 2, width, height])
                    .attr("style", "max-width: 100%; max-height: 100%;");

                // 自适应窗口大小
                const w = window,
                    d = document,
                    e = d.documentElement,
                    g = d.getElementsByTagName('body')[0];
                
                function updateWindow(){
                    width = w.innerWidth || e.clientWidth || g.clientWidth;
                    height = w.innerHeight|| e.clientHeight|| g.clientHeight;
                
                    svg.attr("width", width).attr("height", height);
                }
                d3.select(window).on('resize.updatesvg', updateWindow);

                my.chart = new Chart(svg, data, { showExtraneous: false });
            })
    </script>
</body>

<style>
    body {
        display: block;
        width: 100%;
        height: 100%;
    }
/* 
    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
    }

    .node text {
        font: 12px sans-serif;
    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 4px;
        cursor: pointer;
    }
*/

    .chartTooltip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        box-sizing: border-box;
        background-color: white;
        border-radius: 5px;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
        pointer-events: none;
    }

    .chartTooltip.hidden {
        display: none;
    }

    .chartTooltip p {
        margin: 0;
        font-size: 14px;
        line-height: 20px;
        word-wrap: break-word;
    }

    #chart {
        display: block;
    }
</style>